{
    auto_https off
    email kkucukengin@gmail.com
    # admin off
}

:80 {
    encode gzip

    handle /mlflow* {
        reverse_proxy mlflow:5000
    }

    handle /grafana* {
        basic_auth {
            {$ADMIN_USER} {$ADMIN_HASH}
        }
        # (Optional) makes Grafana aware of the subpath even without env vars
        header_up X-Forwarded-Prefix /grafana
        reverse_proxy grafana:3000
    }

    handle /prometheus* {
        basic_auth {
            {$ADMIN_USER} {$ADMIN_HASH}
        }
        # Prometheus is already running with /prometheus route-prefix; header is harmless
        header_up X-Forwarded-Prefix /prometheus
        reverse_proxy prometheus:9090
    }

    # Default API at /
    reverse_proxy api:8000
}
